(()=>{"use strict";var t=function(t,e,n,o,c,r,a,i,u){var l=n.cloneNode(!0).querySelector(".card"),s=l.querySelector(".card__image"),d=l.querySelector(".card__delete-button"),p=l.querySelector(".card__title"),f=l.querySelector(".card__like-button"),_=l.querySelector(".card__like-score");return p.textContent=t.name||"Untitled",s.setAttribute("alt",t.name||"Untitled"),s.setAttribute("src",t.link),_.textContent=t.likes.length,t.likes.some((function(t){return t._id===e}))&&f.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(){return u(s.src,p.textContent)})),t.owner._id===e?d.addEventListener("click",(function(){r(t._id).then((function(){l.remove()})).catch((function(t){return console.log("Ошибка удаления карточки: ".concat(t))}))})):d.style.display="none",f.addEventListener("click",(function(){f.classList.contains("card__like-button_is-active")?i(t._id).then((function(){f.classList.remove("card__like-button_is-active"),t.likes=t.likes.filter((function(t){return t._id!==e})),_.textContent=t.likes.length})).catch((function(t){return console.log("Ошибка удаления лайка: ".concat(t))})):a(t._id).then((function(){f.classList.add("card__like-button_is-active"),t.likes.push({_id:e}),_.textContent=t.likes.length})).catch((function(t){return console.log("Ошибка добавления лайка: ".concat(t))}))})),l},e=function(t){t.classList.add("popup_is-opened"),t.addEventListener("click",o),document.addEventListener("keydown",c)},n=function(t){t.classList.add("popup_is-animated"),t.classList.remove("popup_is-opened"),t.removeEventListener("click",o),document.removeEventListener("keydown",c),setTimeout((function(){t.classList.remove("popup_is-animated")}),600)},o=function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&n(t.currentTarget)},c=function(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))},r=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},a=function(t,e,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)},i=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent="",e.setCustomValidity("")},u=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(c){i(t,c,e),r(n,o,e)}))},l={baseUrl:"https://mesto.nomoreparties.co/v1/pwff-cohort-1",headers:{authorization:"d1dea879-99ce-4d94-9c28-33c71240ac81","Content-Type":"application/json"}},s=function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))},d=function(t){return fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then(s).catch((function(t){console.log("Ошибка fetch запроса удаления карточки: ".concat(t))}))},p=function(t){return fetch("".concat(l.baseUrl,"/cards/").concat(t,"/likes"),{method:"PUT",headers:l.headers}).then(s).catch((function(t){console.log("Ошибка fetch запроса лайка: ".concat(t))}))},f=function(t){return fetch("".concat(l.baseUrl,"/cards/").concat(t,"/likes"),{method:"DELETE",headers:l.headers}).then(s).catch((function(t){console.log("Ошибка fetch запроса удаления лайка: ".concat(t))}))};function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var h,m,y=document.querySelector(".popup__input_type_name"),v=document.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),g=document.querySelector("#card-template").content,q=document.querySelector(".places__list"),L=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_image"),A=document.querySelector(".popup_type_edit_avatar"),U=document.querySelector(".popup__input_type_card-name"),T=document.querySelector(".popup__input_type_url"),w=x.querySelector(".popup__image"),j=x.querySelector(".popup__caption"),O=document.querySelector(".profile__image"),B=A.querySelector(".popup__input_type_edit_avatar"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(t,e){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}function I(t,n){w.src=t,w.alt=n,j.textContent=n,e(x)}Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(s).catch((function(t){console.log("Ошибка fetch запроса профиля: ".concat(t))})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(s).catch((function(t){console.log("Ошибка fetch запроса карточек: ".concat(t))}))]).then((function(e){var n,o,c=(o=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,c,r,a,i=[],u=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=r.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,c=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw c}}return i}}(n,o)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=c[0],a=c[1];h=r._id,b.textContent=r.name,S.textContent=r.about,O.style.backgroundImage="url('".concat(r.avatar,"')"),a.forEach((function(e){var n=t(e,h,g,0,0,d,p,f,I);q.append(n)}))})).catch((function(t){console.log(t)})),m=P,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);r(n,o,e),n.forEach((function(c){c.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?i(t,e,n):a(t,e,e.validationMessage,n)}(t,c,e),r(n,o,e)}))}))}(t,m)})),k.addEventListener("click",(function(){y.value=b.textContent,v.value=S.textContent,u(E,P),e(E)})),E.addEventListener("submit",(function(t){var e;t.preventDefault(),D(!0,E),(e={name:y.value,about:v.value},fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify(e)}).then(s).catch((function(t){console.log("Ошибка fetch запроса изменения профиля: ".concat(t))}))).then((function(t){b.textContent=t.name,S.textContent=t.about,n(E)})).catch((function(t){console.log("Ошибка fetch запроса изменения профиля: ".concat(t))})).finally((function(){D(!1,E)}))})),L.addEventListener("click",(function(){u(C,P),e(C)})),C.addEventListener("submit",(function(e){var o;e.preventDefault(),D(!0,C),(o={name:U.value,link:T.value},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify(o)}).then(s).catch((function(t){console.log("Ошибка fetch запроса создания новой карточки: ".concat(t))}))).then((function(e){var o=t(e,h,g,0,0,d,p,f,I);q.prepend(o),document.forms["new-place"].reset(),n(C),u(C,P)})).catch((function(t){console.log("Ошибка fetch запроса создания новой карточки: ".concat(t))})).finally((function(){D(!1,C)}))})),O.addEventListener("click",(function(){u(A,P),e(A)})),A.addEventListener("submit",(function(t){var e;t.preventDefault(),D(!0,A),(e={avatar:B.value},fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify(e)}).then(s).catch((function(t){console.log("Ошибка fetch запроса изменения аватара: ".concat(t))}))).then((function(t){O.style.backgroundImage="url('".concat(t.avatar,"')"),n(A),document.forms["edit-avatar-form"].reset(),u(A,P)})).catch((function(t){console.log("Ошибка fetch запроса изменения аватара: ".concat(t))})).finally((function(){D(!1,A)}))}))})();